# this is a sample python script which is used to make a banner grabbing of the applications running on a specific port.
# the optparse library is used to parse the command line options.
# the socket library gives us all the ability to perform a socket .

import optparse
import socket
from socket import *
def connScan(tgtHost,tgtPort):
# this function enumerates through each of the port and tries to create a connection with each of them
# this function will take , namely tgtHost and tgtPort and tries to create a connection with the 	target host and port .
	
	try:		
		connSkt=socket(AF_INET,SOCK_STREAM)
		connSkt.connect((tgtHost,tgtPort))
		connSkt.send('hello buddy')	# sending a garbage value.
		print'the result has been stored'
		results=connSkt.recv(100)
		#  if the tcp port connection was a successfull one , 
		# then the following sentences are been printed.
		print'\n[+] the %d/tcp connection is open .'%tgtPort
		print'[+]'+str(results)
		connSkt.close()
	except:
		# if the tcp port connection could not be established . then the following sentence printed.
		print'\n[-] Sorry %d/tcp port is closed for now. \n\tPlease try some time later ....!!!'%tgtPort


def portScan(tgtHost,tgtPorts):
	# this function takes hostname and target ports as arguments 
	try:
		tgtIP=gethostbyname(tgtHost)
	except:
		print"\n\t[-] Cannot resolve '%s': Unknown host\n"%tgtHost
		return
	try:
		tgtName=gethostbyaddr(tgtIP)
		print'\n[+] Scan Results for :'+tgtName[0]
	except:
		print'\n[+]Scan results for :'+tgtIP
	setdefaulttimeout(1)
	for tgtPort in tgtPorts:
		print'\tScanning port'+tgtPort
		connScan(tgtHost,int(tgtPort))


def main():
	# this block executes at first
	# this checks for the input's correctness and parses the command line arguments
	parser=optparse.OptionParser("usage%prog"+"-H<target host> -p <target port>")
	parser.add_option('-H',dest='tgtHost',type='string',help='specify target host')
	parser.add_option('-p',dest='tgtPort',type='string',help='specify target port[s] separated by comma')
	(options,args)=parser.parse_args()
	tgtHost=options.tgtHost
	tgtPort=str(options.tgtPort).split(',')
	if(tgtHost==None)|(tgtPort[0]==None):
		# this block executes when proper input is not given .
		print'\n[-] You must specify the target\'s Host and Port[s]\n'
		exit(0)
	portScan(tgtHost,tgtPort)	# the portscan function is been called with the arguments target host and target port.


if __name__=='__main__':
	# the main block must be executed only when this program is executed.
	main()


# this is the end of the banner grabbing of an application on a given specific host and ports.
